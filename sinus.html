<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Sinus</title>
    <style>
        svg line{
            stroke: grey;
            stroke-width: 2;
        }
        svg circle{
            stroke: steelblue;
            fill: #21B2B4;
            stroke-width: 2;
        }
        .axis path, .axis line {
            fill: none;
            stroke: #333;
        }
        .axis .grid-line {
            stroke: #000;
            shape-rendering: crispedges;
            stroke-opacity: 0.2;
        }
        .axis text {
            font: 10px Verdana;
        }
    </style>
    <script src="http://d3js.org/d3.v3.min.js"></script>
</head>
<body id = 'body'>
<input id = "count" value = "1000"><br><br>
<input type = "button" id = "reload" value = "Перерисовать" onclick="repaint()">
<input type = "button" id = "remove" value = "Очистить" onclick="remove()"><br><br>
<input type = "checkbox" id = "alerting">Включить уведомления
<script type="text/javascript">
    var body = document.getElementById('body');
    var svgD = document.getElementById('svg');
    var countBox = document.getElementById('count');

    repaint();

    window.onresize = function() {
        repaint();
    };

    function remove(){
        d3.select('body').select('svg').remove();
    }

    function repaint(){
        var width = window.innerWidth - 50;
        var height = window.innerHeight;
        var margin = 30;
        var lastY = 0;
        var x = 0;
        var scroolLevel = 1;
        var count = countBox.value;
        var coef = (width - margin * 2) / count;
        var startTime = new Date();
        var step = 0.1;
        var array = new Array(count);
        var displaying = [{}];

        var svg = d3.select('body').select('svg');
        svg.remove();
        svg = d3.select('body').append('svg')
                .attr('id','svg')
                .attr('height', height)
                .attr('width', width)
                .attr('class', 'axis');

        for (var i = 0; i < count; i++){
            array[i] = Math.sin(i/10);
        }

        /*for (var i = 0; i < array.length; i++){
            svg.append('line')
                    .attr('x1', x)
                    .attr('y1', lastY + 200)
                    .attr('x2', x+1)
                    .attr('y2', array[i] * 100 + 200);
            x += coef;
        }*/  //drawing line by line

        for (var i = 0; i < array.length; i += scroolLevel){
            var point = {y:array[i] * 100 + 200, x:x + margin};
            displaying[displaying.length] = point;
            x += coef;
        }
        displaying[displaying.length] = {x:x + margin - coef, y:200};

        drawPoly(displaying, svg);
        drawAxis(svg, width, 400, margin, count);

        var endTime = new Date();
        if (document.getElementById('alerting').checked == true) alert("Количество синусов: " + count + " штук\n" + startTime + "\n" + endTime + "\nЗатраченно времени: " + (-startTime.getMilliseconds() - startTime.getSeconds() * 1000 - startTime.getMinutes() * 60000
        + endTime.getMilliseconds() + endTime.getSeconds() * 1000 + endTime.getMinutes() * 60000) + " миллисекунд");
    }

    function drawAxis(svg, width, height, margin, maxX){
        // длина оси X= ширина контейнера svg - отступ слева и справа
        var xAxisLength = width - 2 * margin;

        // длина оси Y = высота контейнера svg - отступ сверху и снизу
        var yAxisLength = height- 2 * margin;

        // функция интерполяции значений на ось Х 
        var scaleX = d3.scale.linear()
                .domain([0, maxX])
                .range([0, xAxisLength]);
        var scaleY = d3.scale.linear()
                .domain([-1, 1])
                .range([0, yAxisLength]);

        // создаем ось X  
        var xAxis = d3.svg.axis()
                .scale(scaleX)
                .orient("bottom");
        var yAxis = d3.svg.axis()
                .scale(scaleY)
                .orient("left");

        // отрисовка оси              
        svg.append("g")
                .attr("class", "x-axis")
                .attr("transform",  // сдвиг оси вниз и вправо
                "translate(" + margin + "," + (height - margin) + ")")
                .call(xAxis);

        svg.append("g")
                .attr("class", "y-axis")
                .attr("transform", // сдвиг оси вниз и вправо на margin
                "translate(" + margin + "," + margin + ")")
                .call(yAxis);

        // создаем набор вертикальных линий для сетки  
        d3.selectAll("g.x-axis g.tick")
                .append("line") // добавляем линию
                .classed("grid-line", true) // добавляем класс
                .attr("x1", 0)
                .attr("y1", 0)
                .attr("x2", 0)
                .attr("y2", - (yAxisLength));

        // рисуем горизонтальные линии
        d3.selectAll("g.y-axis g.tick")
                .append("line")
                .classed("grid-line", true)
                .attr("x1", 0)
                .attr("y1", 0)
                .attr("x2", xAxisLength)
                .attr("y2", 0);
    }

    function drawPoly(points, svg){
        var pointsString = "";

        for (var i = 0; i < points.length; i++){
            if (typeof points[i].x != "undefined") pointsString += points[i].x + "," + points[i].y + " ";
        }

        svg.append("polygon")
                .style("fill", "blue")
                .style("stroke", "steelblue")
                .style("stroke-width", "2")
                .attr("points", pointsString);
    }

</script>
</body>
</html>